<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | Wildlife Cam Kit - naturebytes</title>

    <!-- remixicon.com -->

    <link rel="stylesheet" href="static/style.css" />
    <link rel="shortcut icon" href="/static/assets/favicon.webp" type="image/x-icon" />
  </head>
  <body>
    <header>
      <div class="logo">
        <a href="/">
          <img src="static/assets/logo.svg" alt="" id="large-logo" />
          <img src="static/assets/favicon.webp" alt="" id="small-logo" />
        </a>
      </div>

      <div class="links">
        <a href="/" id="link-home" class="active-link">Camera</a>
        <a href="/gallery/0">Gallery</a>
        <a href="https://shop.naturebytes.org/products/wildlife-cam-kit" class="shop-button" target="_blank">naturebytes shop â†—</a>
      </div>
    </header>
    
    <main class="main-wrapper">
      <div class="container">
        <div class="livestream">
          <div class="main-box">
            <img src="{{ url_for('video_feed') }}" alt="" id="livestream" />
            <!-- <div class="timer">
              <img src="/static/assets/record.svg" alt="" class="icon">

              <span>24:01:45</span>
            </div> -->
            <div class="maximize-screen icon" onclick="toggleFullscreen()">
              <img src="/static/assets/maximize.svg" alt="" width="30px" class="live-icon">
            </div>
            <!-- <div class="btn-sec">
              <div class="play-btn icon">
                <img src="/static/assets/play.svg" alt="" class="live-icon">
              </div>
            </div> -->

          </div>
          <div id="camera-actions">
            <div class="take-picture">
            </div>
          </div>

          <div id="camera-controls">
            <div id="camera-state">
              <h3>Camera State</h3>
              <div class="radio-wrapper">
                <label for="live-streaming" class="radio-item">
                  <img src="/static/assets/live.svg" alt="" width="36px">
                  <span class="radio-name">Live Streaming</span>
                  <input type="radio" id="live-streaming" name="camera-type" value="live-streaming" checked>
                </label>
                
                <label for="contract" class="radio-item">
                  <input type="radio" id="contract" name="camera-type" value="contract">
                  <img src="/static/assets/movement.svg" alt="" width="36px">
                  <span class="radio-name">Motion Capture</span>
                </label>
                
                <label for="part-time" class="radio-item">
                  <input type="radio" id="part-time" name="camera-type" value="part-time">
                  <img src="/static/assets/turn-off.svg" alt="" width="36px">
                  <span class="radio-name">Camera Off</span>
                </label>
            </div>
          </div>

          <!-- <div id="capturing-content">
            <h3>Capture Content</h3>
            <div id="button-wrapper">
              <button>Take a Picture</button>
              <button>Record Video</button>
            </div>
          </div> -->
        </div>
          <!-- <div class="btn-all-item">
            <a href="{{url_for('capture_video')}}">
            <div class="c-item">
              <img src="/static/assets/video.svg" alt="">
              <span>Capture video</span>
            </div>
            </a>

            <a href="{{url_for('capture_image')}}">
            <div class="c-item">
              <img src="/static/assets/camera.svg" alt="">

              <span>Capture Image</span>
            </div>
            </a>

            <a href="{{url_for('stop_camera')}}">
            <div class="c-item">
              <img src="/static/assets/stop.svg" alt="">
              
              <span>Stop camera</span>
            </div>
          </a>
          
          <a href="{{url_for('watch_live')}}">
            <div class="c-item">
              <img src="/static/assets/flip.svg" alt="">
              <span>flip camera</span>
            </div>
          </a>
          
          <div class="c-item watch-live">
            <img src="/static/assets/live.svg" alt="" width="30px">
            
            <span>Watch live</span>
          </div>
          </div> -->
        </div>
      <!-- TODO: rotate and move to setting
        Try 90 degrees 
      -->
      
        <div class="aside">
          <div class="testing">
            <div class="head-title">Testing & Settings</div>
            <div class="toggle-group">
              <div class="toggle-header">
                  <div class="name">Test Camera Unit</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
              </div>
            </div>
            <div class="toggle-group">
              <div class="toggle-header">
                  <div class="name">Test PIR Sensor</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
              </div>
            </div>
            <div class="toggle-group">
              <div class="toggle-header">
                  <div class="name">Camera Settings</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
              </div>
            </div>
            <div class="toggle-group">
              <div class="toggle-header">
                <!-- Move it somewhere else -->
                  <div class="name">Restart Camera</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
              </div>
            </div>
          </div>
        
          <div class="help">
            <div class="head-title">Help & Assembly Guides</div>

            <div class="toggle-group">
              <div class="toggle-header">
                  <div class="name">Assembly Guides</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
                <div class="download-assembly">
                  <img src="static/assets/pdf.svg" alt="" />
                  <!--
                    TODO: Do we upload the pdf to the RPi? 
                          On one hand it takes up space,
                          on the other hand it might be better to have it locally then to rely on the user being able to connect to the internet
                    Ans: have it on the sd card probably
                  -->
                  <a href="https://example.com" target="_blank">Download Assembly Guide</a>
                </div>
              </div>
            </div>
            <div class="toggle-group">
              <div class="toggle-header">
                  <div class="name">Troubleshooting & Tips</div>
                  <img class="arrow" src="static/assets/arrow.svg" alt="" />
              </div>
              
              <div class="toggle-content">
                <b>Is something broken? Here's how to fix it..</b>
              </div>
            </div>
          </div>
        </div>
        
        <div class="gallery">
          <div class="title">Your Gallery</div>
          <div class="desc">Your recently captured images will show up here!</div>
          {% if not images %}
            <div id="no-image-yet">
              <img src="{{ url_for('static', filename='assets/no-image.png') }}" alt="" height="100px">
              <h4>No image found</h4>
              <p>Capture your first image using the button below the video feed!</p>
            </div>
          {% else %}
            <div class="img-gallery">
              {% for image in images %}
                <div class="item">
                  <div class="head">
                    <img src={{image}} alt="" class="gallery-image" />
                    <div class="zoom-in">
                      <img src="/static/assets/zoom.svg" alt="" id="zoom-icon">
                    </div>
                  </div>
                  <div class="img-details">
                    <div class="icon">
                      <div class="icon-item download" onclick="downloadImage('{{image}}')">
                        <img src="/static/assets/download.svg" alt="">
                      </div>
                      <div class="icon-item" id="delete-icon">
                        <img src="/static/assets/delete.svg" alt="">
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
            <a href="{{url_for('gallery', page=0)}}" id="view-gallery-wrapper">
              <img src="/static/assets/image.svg" alt="" width="20px">
              <p id="view-gallery">View your whole gallery</p>
            </a>
          {% endif %}
        </div>
      </div>
    </main>

    <!-- Modal for gallery image viewing -->
    <div id="imageModal" class="modal">
      <div id="modal-content-wrapper">
          <span class="close">&times;</span>
          <span class="nav-arrow left-arrow" onclick="navigate(-1)">&#10094;</span>
          <span class="nav-arrow right-arrow" onclick="navigate(1)">&#10095;</span>
          <img class="modal-content" id="modalImage">
      </div>
    </div>

    <script>
      /* For the toggle groups. Testing & Settings and Help & Assembly guides on the right */
      document.addEventListener("DOMContentLoaded", function () {
        const toggleGroups = document.querySelectorAll(".toggle-group");

        toggleGroups.forEach(group => {
          const header = group.querySelector(".toggle-header");
          const content = group.querySelector(".toggle-content");
          const arrow = group.querySelector(".arrow");

          group.addEventListener("click", function (e) {
            if (event.target !== header) {
              content.classList.add("show");
              header.classList.add("active");
            }
          });
          header.addEventListener("click", function (e) {
            e.stopPropagation();

            content.classList.toggle("show");
            header.classList.toggle("active");
          });
        });
      });

      /* Video feed fullscreen toggle */
      let isFullScreen = false;
      function toggleFullscreen() {
        const elem = document.querySelector(".main-box");
        if (!isFullScreen) {
          if (elem.requestFullscreen) {
            elem.requestFullscreen();
          } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
          } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
          } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
          }
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
        }
        isFullScreen = !isFullScreen;
      }
    
      /* Modal Gallery viewing and navigating */
      let currentImageIndex = 0;
      let images = [];

      // Function to open the modal and display the clicked image
      function openModal(index) {
        currentImageIndex = index;
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = images[currentImageIndex];
      }

      // Function to close the modal
      function closeModal() {
        const modal = document.getElementById("imageModal");
        modal.style.display = "none";
      }

      // Function to navigate between images
      function navigate(direction) {
        currentImageIndex += direction;
        if (currentImageIndex >= images.length) {
          currentImageIndex = 0;
        } else if (currentImageIndex < 0) {
          currentImageIndex = images.length - 1;
        }
        const modalImg = document.getElementById("modalImage");
        modalImg.src = images[currentImageIndex];
      }

      // Event listeners for opening and closing the modal
      document.addEventListener("DOMContentLoaded", function () {
        const galleryImages = document.querySelectorAll(".gallery-image");
        images = Array.from(galleryImages).map(img => img.src);

        galleryImages.forEach((img, index) => {
          img.addEventListener("click", () => openModal(index));
        });

        const modal = document.getElementById("imageModal");
        const closeBtn = document.querySelector(".close");
        closeBtn.addEventListener("click", closeModal);

        // Close modal when clicking outside the image
        window.addEventListener("click", function (event) {
          if (event.target === modal) {
            closeModal();
          }
        });
      });
    
      function downloadImage(image) {
        const a = document.createElement("a");
        a.href = image;
        a.download = "image.jpg";
        a.click();
      }
    </script>
  </body>
</html>
